<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Proposal Realm - Rishu & Ruhi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        /* Custom CSS for the Magical Feel and Animations */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d1f; /* Deep night sky */
        }

        /* --- Background Effects: Stars & Mist --- */
        #bg-canvas {
            position: fixed; /* Fixed position so background stays put even with scroll */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        .mist {
            position: fixed; /* Fixed position to maintain dreamy effect on scroll */
            bottom: 0;
            width: 100%;
            height: 20vh;
            background: radial-gradient(ellipse at 50% 100%, rgba(200, 200, 255, 0.1), transparent 70%);
            z-index: 15;
            pointer-events: none;
        }

        /* --- Text Styling and Glow --- */
        .proposal-text {
            color: transparent;
            font-size: 2.5rem;
            line-height: 1.2;
            letter-spacing: 0.05em;
            text-shadow: 0 0 10px #FFD700, 0 0 20px rgba(255, 215, 0, 0.5);
            background-color: transparent;
            opacity: 0;
            
            /* Initial Blur and Transition */
            filter: blur(8px); /* Heavily blurred at start */
            transition: opacity 1s ease-in-out, filter 1s ease-in-out; 
            
            font-weight: 700;
        }
        .text-visible {
            opacity: 1;
        }
        .text-unblurred {
            filter: blur(0); /* Unblurred state is applied in JS */
        }

        /* Heartbeat animation for the final line */
        .heartbeat {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        /* --- YES Button Styling and Pulse --- */
        #yes-button {
            padding: 1rem 3rem;
            border: 2px solid #FF80AB;
            background: linear-gradient(45deg, #FF80AB, #FFC0CB);
            color: #1a0808;
            font-weight: 800;
            font-size: 1.5rem;
            box-shadow: 0 0 15px #FF80AB, 0 0 30px #FFC0CB;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: pulse-button 2s infinite ease-in-out;
        }
        #yes-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #FF80AB, 0 0 40px #FFC0CB;
        }
        @keyframes pulse-button {
            0%, 100% { box-shadow: 0 0 15px #FF80AB; }
            50% { box-shadow: 0 0 30px #FFC0CB, 0 0 50px #FF80AB; }
        }

        /* --- Final Message & Post-Click Effects --- */
        #final-message {
            opacity: 0;
            transition: opacity 2s ease-out;
        }
        
        /* --- Navigation Bar --- */
        #nav-bar {
            background-color: rgba(0, 0, 0, 0.5); 
        }
        .nav-link {
            transition: color 0.3s;
        }
        .nav-link:hover {
            color: #FF80AB;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .proposal-text {
                font-size: 1.5rem;
            }
            #yes-button {
                font-size: 1.25rem;
                padding: 0.75rem 2rem;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col justify-center items-center">

    <!-- NAVIGATION BAR (Only Back Button Remains) -->
    <nav id="nav-bar" class="fixed top-0 left-0 right-0 p-4 z-50 rounded-b-xl shadow-lg">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <a href="page15.html" id="back-link" class="nav-link text-white/70 hover:text-white font-medium flex items-center transition-opacity duration-1000">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-1">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                </svg>
                Back to Page 15
            </a>
            <!-- Removed 'Next Page' button from here -->
        </div>
    </nav>

    <!-- BACKGROUND CANVAS FOR STARS/FIREFLIES -->
    <canvas id="bg-canvas"></canvas>

    <!-- MIST EFFECT -->
    <div class="mist"></div>

    <!-- MAIN CONTENT AREA (THREE.JS CONTAINER & TEXT OVERLAY) -->
    <main class="relative w-full h-screen flex flex-col justify-center items-center z-20">
        <!-- Three.js Ring Container -->
        <div id="ring-container" class="relative w-96 h-96 lg:w-[32rem] lg:h-[32rem] pointer-events-none">
            <!-- Canvas will be appended here -->
        </div>

        <!-- Ring Inner Text Overlay -->
        <div id="inner-text" class="absolute pointer-events-none text-center transform -translate-y-1/2 mt-[-5%] transition-opacity duration-1000" style="z-index: 30; opacity: 0;">
            <p class="text-4xl lg:text-5xl font-extrabold" style="color: #FFD700; text-shadow: 0 0 5px #FF80AB, 0 0 10px #FFD700;">Rishu <span class="text-pink-400">‚ù§Ô∏è</span> Ruhi</p>
        </div>

        <!-- Proposal Text Sequence -->
        <div class="absolute inset-0 flex flex-col justify-center items-center pt-[30vh] lg:pt-[25vh] space-y-4" style="z-index: 40;">
            <p id="line-1" class="proposal-text text-golden">‚ÄúIf forever had a face‚Ä¶‚Äù</p>
            <p id="line-2" class="proposal-text text-golden">‚ÄúIt would be ours.‚Äù ‚ú®</p>
            <div class="h-8"></div>
            <p id="line-3" class="proposal-text text-golden">‚ÄúWill you stay with me‚Ä¶ for every lifetime?‚Äù üí´</p>

            <!-- YES BUTTON -->
            <button id="yes-button" class="mt-12 rounded-full hidden" onclick="handleYesClick()">
                ü©∑ YES üíñ
            </button>

            <!-- FINAL MESSAGE -->
            <p id="final-message" class="text-3xl text-center mt-12 font-bold text-pink-300" style="text-shadow: 0 0 10px #FF80AB; opacity: 0;">
                ‚ÄúYou just made my forever real, Sona üíû‚Äù
            </p>
        </div>
        
        <!-- NEW BOTTOM NAVIGATION CONTROL -->
        <div id="bottom-controls" class="absolute bottom-10 w-full flex justify-center z-50 opacity-0 transition-opacity duration-1000">
            <a href="page17.html" id="next-page-button" class="px-6 py-3 rounded-full text-lg font-bold transition-all duration-300 hover:scale-105"
                style="background: linear-gradient(45deg, #FFD700, #FFC0CB); color: #1a0808; box-shadow: 0 0 10px #FFD700;">
                Continue to The Birthday Finale ‚û°Ô∏è
            </a>
        </div>
    </main>

    <script>
        // Global variables for Firebase access (required by platform)
        const __app_id = typeof window.__app_id !== 'undefined' ? window.__app_id : 'proposal-realm-app';
        const __firebase_config = typeof window.__firebase_config !== 'undefined' ? window.__firebase_config : '{}';

        // --- CORE PROPOSAL LOGIC ---

        // Three.js Setup
        let scene, camera, renderer, ring, ringMaterial;
        const ringContainer = document.getElementById('ring-container');

        function initThreeJS() {
            // Scene Setup
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, ringContainer.clientWidth / ringContainer.clientHeight, 0.1, 1000);
            camera.position.z = 5;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(ringContainer.clientWidth, ringContainer.clientHeight);
            ringContainer.appendChild(renderer.domElement);

            // Ring Geometry (Torus)
            const geometry = new THREE.TorusGeometry(1.5, 0.15, 30, 200);

            // Ring Material (Soft Glowing Gold)
            ringMaterial = new THREE.MeshPhongMaterial({
                color: 0xFFD700, // Golden color
                specular: 0xFFFFFF,
                shininess: 100,
                emissive: 0xFFB300, // Glow
                emissiveIntensity: 0.5
            });
            ring = new THREE.Mesh(geometry, ringMaterial);
            scene.add(ring);

            // Lighting (Ambient and Point Light for sparkle)
            const ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.2);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xFFFFFF, 1.5);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            // Handle resizing
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = ringContainer.clientWidth / ringContainer.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(ringContainer.clientWidth, ringContainer.clientHeight);
        }

        function animateRing() {
            requestAnimationFrame(animateRing);
            ring.rotation.x += 0.005;
            ring.rotation.y += 0.008;
            renderer.render(scene, camera);
        }

        // --- Background Canvas Effects (Stars and Fireflies) ---
        const bgCanvas = document.getElementById('bg-canvas');
        const ctx = bgCanvas.getContext('2d');
        let fireflies = [];
        let stars = [];
        let heartParticles = [];
        let fireflyCount = 50;
        let starCount = 100;
        let isProposalAccepted = false;

        function resizeCanvas() {
            bgCanvas.width = window.innerWidth;
            bgCanvas.height = window.innerHeight;
        }

        class Star {
            constructor() {
                this.x = Math.random() * bgCanvas.width;
                this.y = Math.random() * bgCanvas.height;
                this.radius = Math.random() * 1.5;
                this.alpha = Math.random();
                this.velocity = Math.random() * 0.005; // For shimmering
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
                ctx.fill();
            }
            update() {
                this.alpha += this.velocity;
                if (this.alpha <= 0 || this.alpha >= 1) {
                    this.velocity = -this.velocity;
                }
                this.draw();
            }
        }

        class Firefly {
            constructor() {
                this.x = Math.random() * bgCanvas.width;
                this.y = Math.random() * bgCanvas.height;
                this.radius = Math.random() * 2 + 1;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.alpha = Math.random();
                this.baseAlpha = this.alpha;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                const glowColor = isProposalAccepted ? '#FF80AB' : '#FFD700';
                ctx.fillStyle = `rgba(255, 215, 0, ${this.alpha})`;
                ctx.shadowBlur = 10;
                ctx.shadowColor = glowColor;
                ctx.fill();
                ctx.shadowBlur = 0; // Reset shadow
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;

                // Simple boundaries and direction change
                if (this.x < 0 || this.x > bgCanvas.width) this.vx = -this.vx;
                if (this.y < 0 || this.y > bgCanvas.height) this.vy = -this.vy;

                this.alpha = this.baseAlpha + (Math.sin(Date.now() * 0.005 + this.x * 0.01) * 0.5);
                this.draw();
            }
        }

        function initBackground() {
            resizeCanvas();
            for (let i = 0; i < fireflyCount; i++) {
                fireflies.push(new Firefly());
            }
            for (let i = 0; i < starCount; i++) {
                stars.push(new Star());
            }
        }

        function animateBackground() {
            requestAnimationFrame(animateBackground);
            ctx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            ctx.fillStyle = 'rgba(13, 13, 31, 0.2)'; // Fading effect for trails
            ctx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);

            if (!isProposalAccepted) {
                stars.forEach(star => star.update());
                fireflies.forEach(firefly => firefly.update());
            } else {
                // Post-click: Fireflies gather and heart explosion
                updateHeartParticles();
            }
        }

        // --- Proposal Sequence Control ---
        const line1 = document.getElementById('line-1');
        const line2 = document.getElementById('line-2');
        const line3 = document.getElementById('line-3');
        const yesButton = document.getElementById('yes-button');
        const innerText = document.getElementById('inner-text');
        const bottomControls = document.getElementById('bottom-controls');


        async function startProposalSequence() {
            // Lines start with opacity: 0 and filter: blur(8px) by default

            await new Promise(resolve => setTimeout(resolve, 1000));
            line1.classList.add('text-visible', 'text-unblurred'); // Visible and unblur
            innerText.style.opacity = 1; // Show Rishu ‚ù§Ô∏è Ruhi

            await new Promise(resolve => setTimeout(resolve, 2000));
            line2.classList.add('text-visible', 'text-unblurred'); // Visible and unblur

            await new Promise(resolve => setTimeout(resolve, 2500));
            line3.classList.add('text-visible', 'heartbeat', 'text-unblurred'); // Visible and unblur

            await new Promise(resolve => setTimeout(resolve, 1000));
            yesButton.classList.remove('hidden');
        }

        // --- Post-Click Animation and Logic ---
        function handleYesClick() {
            if (isProposalAccepted) return;
            isProposalAccepted = true;

            // 1. Hide interactive elements
            line1.style.opacity = 0;
            line2.style.opacity = 0;
            line3.style.opacity = 0;
            yesButton.style.display = 'none';

            // 2. Ring Pink Glow
            ringMaterial.emissive.setHex(0xFF1493); // Deep pink glow
            ringMaterial.color.setHex(0xFFC0CB); // Soft pink
            // Stop spinning and slightly adjust position for impact
            ring.rotation.x = 0.5; 
            ring.rotation.y = 0.5;

            // 3. Trigger Heart Explosion (Background effect)
            generateHeartParticles();

            // 4. Show Final Message & New Navigation Button
            setTimeout(() => {
                const finalMessage = document.getElementById('final-message');
                finalMessage.style.opacity = 1;

                // 5. Show Bottom Navigation Button
                bottomControls.style.opacity = 1; 

                // Note: The body transition is removed to prevent premature fade out.
            }, 1500);
        }

        // Heart-shaped particle generation
        function generateHeartParticles() {
            const centerX = bgCanvas.width / 2;
            const centerY = bgCanvas.height / 2;
            const totalParticles = 400;

            for (let i = 0; i < totalParticles; i++) {
                // Heart shape parameterization (simplified)
                const t = Math.random() * (2 * Math.PI);
                const r = 200; // Size of the heart
                const heartX = r * (16 * Math.pow(Math.sin(t), 3));
                const heartY = -r * (13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));

                heartParticles.push({
                    x: centerX,
                    y: centerY,
                    targetX: centerX + heartX * 0.5, // Scale down target
                    targetY: centerY + heartY * 0.5,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    size: Math.random() * 3 + 1,
                    life: 1,
                    color: i % 2 === 0 ? '#FFD700' : '#FF80AB',
                    opacity: 1,
                    // Use a time to transition from explosion to heart shape
                    transitionTime: Math.random() * 50 + 50
                });
            }
        }

        function updateHeartParticles() {
            for (let i = 0; i < heartParticles.length; i++) {
                const p = heartParticles[i];

                if (p.transitionTime > 0) {
                    // Initial Explosion Phase
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vx *= 0.95; // Slow down
                    p.vy *= 0.95;
                    p.transitionTime--;
                } else {
                    // Heart Shape Phase (Move towards target)
                    p.x += (p.targetX - p.x) * 0.05;
                    p.y += (p.targetY - p.y) * 0.05;
                    p.life -= 0.005;
                }

                p.opacity = p.life;

                if (p.life > 0) {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(${p.color === '#FFD700' ? '255, 215, 0' : '255, 128, 171'}, ${p.opacity})`;
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = p.color;
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }
            // Remove dead particles
            heartParticles = heartParticles.filter(p => p.life > 0);
        }

        // --- Initialization ---
        window.onload = function() {
            // Wait for DOM to be ready and sizes to be calculated
            initThreeJS();
            animateRing();

            initBackground();
            animateBackground();

            startProposalSequence();
        };
    </script>
</body>
</html>
